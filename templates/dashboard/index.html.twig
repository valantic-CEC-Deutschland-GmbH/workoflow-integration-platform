{% extends 'base.html.twig' %}

{% block title %}{{ 'general.title'|trans }} - Workoflow{% endblock %}

{% block body %}
<div class="dashboard-page">
    <div class="dashboard-container">

        {# Zone 1 - Agent Identity Header #}
        <div class="dashboard-hero">
            <div class="agent-avatar">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                    <circle cx="8.5" cy="16" r="1.5"/>
                    <circle cx="15.5" cy="16" r="1.5"/>
                    <path d="M8 11V7a4 4 0 0 1 8 0v4"/>
                    <path d="M12 3v1"/>
                </svg>
            </div>
            <div class="dashboard-hero-text">
                <h1 class="dashboard-title">{{ 'general.welcome'|trans({'%name%': user.name}) }}</h1>
                {% if isOnboarding %}
                    <p class="dashboard-subtitle">{{ 'general.agent_ready_setup'|trans }}</p>
                {% else %}
                    <p class="dashboard-subtitle">{{ 'general.agent_ready'|trans({'%count%': integrations|length}) }}</p>
                {% endif %}
                {% if organisation %}
                    <p class="dashboard-tenant-name">{{ organisation.name }}</p>
                {% endif %}
            </div>
        </div>

        {# Zone 2 - Conditional content based on user state #}
        {% if isOnboarding %}
            {# State A: Onboarding card #}
            <div class="onboarding-card">
                <div class="onboarding-card-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/>
                    </svg>
                </div>
                <h2 class="onboarding-card-title">{{ 'general.onboarding_title'|trans }}</h2>
                <p class="onboarding-card-description">{{ 'general.onboarding_description'|trans }}</p>
                <a href="{{ path('app_skills') }}" class="btn btn-primary btn-lg">
                    {{ 'general.add_first_skill'|trans }}
                </a>
            </div>
        {% endif %}

        {# Zone 3 - Primary Action Card #}
        <div class="primary-action-card">
            <div class="primary-action-card-text">
                <h3>{{ 'general.manage_skills_title'|trans }}</h3>
                <p>{{ 'general.manage_skills_description'|trans }}</p>
            </div>
            <a href="{{ path('app_skills') }}" class="btn btn-primary">
                {{ 'general.manage_agent_skills'|trans }}
            </a>
        </div>

        {# Zone 4 - Recent Skills (only when 1+ skills) #}
        {% if not isOnboarding %}
            <div class="recent-skills-section">
                <div class="recent-skills-header">
                    <h3>{{ 'general.recent_skills'|trans }}</h3>
                    <a href="{{ path('app_skills') }}" class="view-all-link">{{ 'general.view_all'|trans }} &rarr;</a>
                </div>
                <div class="recent-skills-grid">
                    {% for integration in integrations|slice(0, 5) %}
                        <div class="recent-skill-card">
                            {% set skillType = integration.integrationType %}
                            {% set logoPath = configuredSkills[skillType] is defined ? configuredSkills[skillType].logoPath : '/images/logos/workoflow-logo.png' %}
                            <div class="recent-skill-card-header">
                                <img src="{{ asset(logoPath) }}" alt="{{ skillType }}" width="28" height="28" class="recent-skill-logo">
                                <span class="recent-skill-name">{{ integration.name }}</span>
                            </div>
                            <div class="recent-skill-card-footer">
                                {% if integration.active %}
                                    <span class="badge badge-active">{{ 'status.active'|trans }}</span>
                                {% else %}
                                    <span class="badge badge-inactive">{{ 'status.inactive'|trans }}</span>
                                {% endif %}
                                <a href="{{ path('app_tool_setup', {'type': skillType, 'instance': integration.id}) }}" class="btn btn-sm btn-secondary">
                                    {{ 'integration.edit'|trans }}
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}
