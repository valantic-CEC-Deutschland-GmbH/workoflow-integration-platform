{% extends 'base.html.twig' %}

{% block title %}{{ 'general.title'|trans }} - Workoflow{% endblock %}

{% block body %}
<div class="dashboard-page">
    <div class="dashboard-container">

        {# Zone 1 - Agent Identity Header #}
        <div class="dashboard-hero">
            <div class="agent-avatar">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                    <circle cx="8.5" cy="16" r="1.5"/>
                    <circle cx="15.5" cy="16" r="1.5"/>
                    <path d="M8 11V7a4 4 0 0 1 8 0v4"/>
                    <path d="M12 3v1"/>
                </svg>
            </div>
            <div class="dashboard-hero-text">
                <h1 class="dashboard-title">{{ 'general.welcome'|trans({'%name%': user.name}) }}</h1>
                {% if isOnboarding %}
                    <p class="dashboard-subtitle">{{ 'general.agent_ready_setup'|trans }}</p>
                {% else %}
                    <p class="dashboard-subtitle">{{ 'general.agent_ready'|trans({'%count%': integrations|length}) }}</p>
                {% endif %}
                {% if organisation %}
                    <p class="dashboard-tenant-name">{{ organisation.name }}</p>
                {% endif %}
            </div>
        </div>

        {# Zone 2 - Conditional content based on user state #}
        {% if isOnboarding %}
            {# State A: Onboarding card #}
            <div class="onboarding-card">
                <div class="onboarding-card-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/>
                    </svg>
                </div>
                <h2 class="onboarding-card-title">{{ 'general.onboarding_title'|trans }}</h2>
                <p class="onboarding-card-description">{{ 'general.onboarding_description'|trans }}</p>
                <a href="{{ path('app_skills') }}" class="btn btn-primary btn-lg">
                    {{ 'general.add_first_skill'|trans }}
                </a>
            </div>
        {% endif %}

        {# Zone 3 - Primary Action Card #}
        <div class="primary-action-card">
            <div class="primary-action-card-text">
                <h3>{{ 'general.manage_skills_title'|trans }}</h3>
                <p>{{ 'general.manage_skills_description'|trans }}</p>
            </div>
            <a href="{{ path('app_skills') }}" class="btn btn-primary">
                {{ 'general.manage_agent_skills'|trans }}
            </a>
        </div>

        {# Zone 3.5 - Activity Overview (only when stats available) #}
        {% if stats is not null %}
            <div class="activity-overview-section">
                <div class="activity-overview-header">
                    <h3>{{ 'general.stats_title'|trans }}</h3>
                    <span class="activity-overview-period">{{ 'general.stats_period'|trans({'%days%': 30}) }}</span>
                </div>
                <div class="activity-stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.agent_sessions }}</div>
                        <div class="stat-card-label">{{ 'general.stats_agent_sessions'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.tool_executions }}</div>
                        <div class="stat-card-label">{{ 'general.stats_tool_executions'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{% if stats.tool_success_rate is not null %}{{ stats.tool_success_rate }}%{% else %}--{% endif %}</div>
                        <div class="stat-card-label">{{ 'general.stats_success_rate'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.api_calls }}</div>
                        <div class="stat-card-label">{{ 'general.stats_api_calls'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.prompt_activity }}</div>
                        <div class="stat-card-label">{{ 'general.stats_prompt_activity'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.active_skills }}</div>
                        <div class="stat-card-label">{{ 'general.stats_active_skills'|trans }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                            </svg>
                        </div>
                        <div class="stat-card-value">{{ stats.tool_types_used }}</div>
                        <div class="stat-card-label">{{ 'general.stats_tool_types_used'|trans }}</div>
                    </div>
                </div>

                {% if stats.top_tools|length > 0 %}
                    <div class="top-tools-section">
                        <h4>{{ 'general.stats_top_tools'|trans }}</h4>
                        <div class="top-tools-list">
                            {% for tool in stats.top_tools %}
                                <div class="top-tool-item">
                                    <span class="top-tool-rank">#{{ loop.index }}</span>
                                    <span class="top-tool-name">{{ tool.tool_name }}</span>
                                    <span class="top-tool-count">{{ tool.count }}x</span>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>
        {% endif %}

        {# Zone 4 - Recent Skills (only when 1+ skills) #}
        {% if not isOnboarding %}
            <div class="recent-skills-section">
                <div class="recent-skills-header">
                    <h3>{{ 'general.recent_skills'|trans }}</h3>
                    <a href="{{ path('app_skills') }}" class="view-all-link">{{ 'general.view_all'|trans }} &rarr;</a>
                </div>
                <div class="recent-skills-grid">
                    {% for integration in integrations|slice(0, 5) %}
                        <div class="recent-skill-card">
                            {% set skillType = integration.integrationType %}
                            {% set logoPath = configuredSkills[skillType] is defined ? configuredSkills[skillType].logoPath : '/images/logos/workoflow-logo.png' %}
                            <div class="recent-skill-card-header">
                                <img src="{{ asset(logoPath) }}" alt="{{ skillType }}" width="28" height="28" class="recent-skill-logo">
                                <span class="recent-skill-name">{{ integration.name }}</span>
                            </div>
                            <div class="recent-skill-card-footer">
                                {% if integration.active %}
                                    <span class="badge badge-active">{{ 'status.active'|trans }}</span>
                                {% else %}
                                    <span class="badge badge-inactive">{{ 'status.inactive'|trans }}</span>
                                {% endif %}
                                <a href="{{ path('app_tool_setup', {'type': skillType, 'instance': integration.id}) }}" class="btn btn-sm btn-secondary">
                                    {{ 'integration.edit'|trans }}
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}
